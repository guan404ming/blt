================================================================================
     Current Translation Flow
     ================================================================================

     1. INITIALIZATION (translator.py:18-51)
        └─ LyricsTranslator.__init__()
           ├─ Load API key from environment (GOOGLE_API_KEY)
           ├─ Initialize PydanticAI Agent with:
           │  ├─ Model: gemini-pro-flash
           │  ├─ Output type: LyricTranslation (Pydantic model for structured output)
           │  └─ System prompt: Role-specific instructions
           ├─ Initialize FeatureExtractor (automatic constraint extraction)
           └─ Initialize ConstraintValidator (validation & feedback)

     2. TRANSLATION REQUEST (translator.py:83-132)
        └─ translate(source_lyrics, source_lang, target_lang, constraints)
           │
           ├─ STEP 1: Extract Constraints (if not provided)
           │  └─ FeatureExtractor.extract_constraints()
           │     ├─ Split lyrics into lines
           │     ├─ Count syllables per line (feature_extractor.py:53-91)
           │     │  └─ For English: Use CMU Pronouncing Dictionary
           │     │     ├─ pronouncing.phones_for_word() → get phonemes
           │     │     ├─ pronouncing.syllable_count() → count syllables
           │     │     └─ Fallback: vowel counting for unknown words
           │     ├─ Detect rhyme scheme (feature_extractor.py:122-147)
           │     │  └─ Extract rhyme endings → assign labels (A, B, C, ...)
           │     └─ Infer pause positions from punctuation
           │
           ├─ STEP 2: Build Prompt (translator.py:134-170)
           │  └─ _build_prompt()
           │     ├─ Original lyrics + source language
           │     ├─ Target language
           │     └─ Music constraints:
           │        ├─ Syllable counts: [15, 9, 15, 11, 15, 12]
           │        ├─ Rhyme scheme: ABCDEE
           │        └─ Pause positions: [15, 24, 39, 50, 65, 77]
           │
           ├─ STEP 3: Call LLM (translator.py:117-119)
           │  └─ agent.run_sync(user_prompt)
           │     ├─ PydanticAI sends prompt to Gemini Pro Flash
           │     ├─ Model generates structured response
           │     └─ Returns Pydantic object (LyricTranslation)
           │
           ├─ STEP 4: Recalculate Syllables (translator.py:145-160)
           │  └─ _recalculate_syllables()
           │     └─ Recalculate syllable counts for the translated lyrics
           │
           └─ STEP 5: Validate & Display Results (translator.py:121-127)
              └─ ConstraintValidator.validate()
                 ├─ Check syllable counts
                 ├─ Check rhyme scheme
                 └─ Calculate overall score

     ================================================================================
     OUTPUT FORMATS
     ================================================================================

     LyricTranslation (Structured Output)
        ├─ translated_lines: list[str]
        ├─ syllable_counts: list[int]
        ├─ rhyme_endings: list[str]
        ├─ reasoning: str
        └─ constraint_satisfaction: dict[str, bool]

     ================================================================================
     KEY COMPONENTS
     ================================================================================

     1. Feature Extraction (feature_extractor.py)
        ├─ Syllable counting (CMU Pronouncing Dictionary)
        ├─ Rhyme detection (phonetic endings)
        └─ Pause inference (punctuation-based)

     2. Constraint Validation (validator.py)
        ├─ Length validation (syllable accuracy)
        ├─ Rhyme validation (pattern matching)
        └─ Feedback generation (error descriptions)

     3. LLM Integration (translator.py)
        ├─ PydanticAI Agent (structured output)
        ├─ Gemini Pro Flash (fast, accurate)
        └─ System prompts (role + constraints)

     4. Models (models.py)
        ├─ MusicConstraints (input constraints)
        ├─ LyricTranslation (structured output)
        └─ ValidationResult (validation feedback)

     ================================================================================
     EXAMPLE FLOW FOR "擱淺"
     ================================================================================

     Input:
       久未放晴的天空 依舊留著妳的笑容
       哭過 卻無法掩埋歉疚
       ...

     ↓ Extract Constraints
       Syllables: [15, 9, 15, 11, 15, 12]
       Rhyme: ABCDEE
       Pauses: [15, 24, 39, 50, 65, 77]

     ↓ Build Prompt
       原始歌詞: [Chinese lyrics]
       目標語言: English
       音樂約束: [constraints]

     ↓ LLM Translation
       ✓ Translated lines are generated
       ✓ Syllable counts are recalculated
       ✓ Rhyme endings are extracted

     ↓ Validation
       Score: 100% (all constraints met)

     ↓ Output
       The sky that hasn't cleared for so long, still keeps your gentle smile.
       I cried, but can't hide away my guilt.
       ...

     ================================================================================
